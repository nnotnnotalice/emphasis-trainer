<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тренажёр по ударениям</title>

    <style>
        /* Все стили остаются без изменений */
        :root {
            --primary: #8A8EE9;
            --primary-hover: #7075e2;
            --success: #d6f5d8;
            --error: #ffd9d9;
            --text: #111827;
            --muted: #6B7280;
            --bg: #f5f5f7;
        }

        body {
            font-family: "Nunito", sans-serif;
            background: var(--bg);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .app {
            background: #ffffff;
            padding: 24px 28px;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.07);
            max-width: 520px;
            width: 100%;
            position: relative;
        }

        h1 {
            font-size: 24px;
            margin: 0 0 4px;
            text-align: center;
            font-weight: 700;
        }

        .subtitle {
            font-size: 16px;
            color: var(--muted);
            text-align: center;
            margin-bottom: 8px;
            font-weight: 400;
        }

        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .batches-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .batch-card {
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .batch-card:hover {
            background: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .batch-card.completed {
            background: #d4edda;
            border-color: #28a745;
        }

        .batch-card.current {
            background: #d1ecf1;
            border-color: #17a2b8;
        }

        .batch-checkmark {
            color: #28a745;
            font-size: 20px;
            margin-bottom: 5px;
        }

        .session-counter {
            font-size: 13px;
            color: #777;
            margin-bottom: 8px;
            text-align: center;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 14px;
            align-items: center;
            margin-bottom: 8px;
            width: 100%;
        }

        .option-btn {
            padding: 16px 18px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            font-size: 20px;
            text-align: center;
            background: #ffffff;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
            transition: transform 0.05s ease, box-shadow 0.05s ease, background 0.1s ease;
            min-width: 70%;
            font-weight: 400;
        }

        .option-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.07);
        }

        .option-btn.correct {
            background: var(--success);
        }

        .option-btn.wrong {
            background: var(--error);
        }

        .option-btn:disabled {
            cursor: default;
            opacity: 0.9;
        }

        .status {
            min-height: 18px;
            font-size: 14px;
            margin-top: 4px;
            text-align: center;
        }

        .status.err {
            color: #c92424;
        }

        .loader-overlay {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            z-index: 10;
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 28px;
            height: 28px;
            animation: spin 0.8s linear infinite;
        }

        .hidden {
            display: none;
        }

        @keyframes spin {
            0%   { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .pos-choices {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            width: 100%;
        }

        .pos-btn {
            padding: 14px 20px;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            background: #b9c2ff;
            color: #1f2455;
            box-shadow: 0 4px 10px rgba(60, 72, 150, 0.25);
            transition: background 0.1s ease, transform 0.05s ease;
            min-width: 70%;
            font-weight: 400;
        }

        .pos-btn:hover {
            background: #a6b1ff;
            transform: translateY(-1px);
        }

        .summary-congrats {
            text-align: center;
            width: 100%;
            font-size: 20px;
            font-weight: 500;
            margin-bottom: 18px;
        }

        #footerButtons {
            display: flex;
            justify-content: center;
            padding-top: 12px;
        }

        .result-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .result-btn {
            padding: 10px 16px;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            background: var(--primary);
            color: #ffffff;
            box-shadow: 0 4px 12px rgba(138, 142, 233, 0.4);
            transition: transform 0.05s ease;
            font-weight: 400;
        }

        .result-btn:hover {
            transform: translateY(-1px);
        }

        .summary-list-wrapper {
            text-align: center;
            margin-top: 8px;
        }

        .summary-list {
            list-style: none;
            padding-left: 0;
            margin: 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px 10px;
        }

        .summary-list li {
            background: #e1f7e7;
            color: #145c2e;
            border-radius: 8px;
            padding: 6px 10px;
            font-size: 15px;
            font-weight: 400;
            min-width: 40%;
            text-align: center;
            box-sizing: border-box;
        }

        .pos-choices {
            display: flex;
            flex-direction: column;
            gap: 12px;
            justify-content: center;
            width: 100%;
            max-height: 300px;
            overflow-y: auto;
        }

        .pos-btn {
            padding: 14px 20px;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            background: #b9c2ff;
            color: #1f2455;
            box-shadow: 0 4px 10px rgba(60, 72, 150, 0.25);
            transition: background 0.1s ease, transform 0.05s ease;
            width: 100%;
            font-weight: 400;
        }

        .summary-subtitle {
            text-align: center;
            margin-bottom: 15px;
            font-weight: 600;
            color: var(--text);
        }
        
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
        }
        
        .back-btn:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
        }
    </style>
</head>

<body>
    <div class="app">
        <button id="backButton" class="back-btn hidden">←</button>
        <h1>Тренажёр по ударениям</h1>
        <div id="subtitle" class="subtitle"></div>

        <div class="main">
            <!-- Основной интерфейс -->
            <div id="mainInterface">
                <div id="sessionInfo" class="session-counter"></div>
                <div id="batchesSelection" class="hidden">
                    <h3>Выбери двадцатку для отработки</h3>
                    <div class="batches-grid" id="batchesGrid"></div>
                </div>
                <div id="options" class="options"></div>
                <div id="status" class="status"></div>
                <div id="summary"></div>
            </div>
        </div>

        <div id="footerButtons"></div>
        <div id="loaderOverlay" class="loader-overlay hidden">
            <div class="loader"></div>
        </div>
    </div>

    <script>
        // Константы
        const DELAY_AFTER_CORRECT = 700;
        const DELAY_AFTER_WRONG = 1800;

        // Переменные состояния
        let currentPOS = null;
        let currentBatch = [];
        let currentBatchNumber = null;
        let currentIndex = 0;
        let mistakes = [];
        let lastErrorsForReview = [];
        let answered = false;
        let isReviewMode = false;

        // Данные слов из таблицы
        const wordsData = {
            "Существительные": {
                1: [
                    { correct_word: "аэропОрты", wrong_options: "аэропортЫ" },
                    { correct_word: "бАнты", wrong_options: "бантЫ" },
                    { correct_word: "бОроду", wrong_options: "бородУ" },
                    { correct_word: "бухгАлтеров", wrong_options: "бухгалтерОв" },
                    { correct_word: "вероисповЕдание", wrong_options: "вероисповедАние" },
                    { correct_word: "водопровОд", wrong_options: "водопрОвод" },
                    { correct_word: "газопровОд", wrong_options: "газопрОвод" },
                    { correct_word: "граждАнство", wrong_options: "грАжданство" },
                    { correct_word: "дефИс", wrong_options: "дЕфис" },
                    { correct_word: "дешевИзна", wrong_options: "дешевизнА" },
                    { correct_word: "диспансЕр", wrong_options: "диспАнсер" },
                    { correct_word: "договорЁнность", wrong_options: "договОренность" },
                    { correct_word: "докумЕнт", wrong_options: "докУмент" },
                    { correct_word: "досУг", wrong_options: "дОсуг" },
                    { correct_word: "еретИк", wrong_options: "ерЕтик" },
                    { correct_word: "жалюзИ", wrong_options: "жАлюзи" },
                    { correct_word: "знАчимость", wrong_options: "значИмость" },
                    { correct_word: "Иксы", wrong_options: "иксЫ" },
                    { correct_word: "каталОг", wrong_options: "катАлог" },
                    { correct_word: "квартАл", wrong_options: "квАртал" }
                ],
                2: [
                    { correct_word: "киломЕтр", wrong_options: "килОметр" },
                    { correct_word: "кОнусов", wrong_options: "конусОв" },
                    { correct_word: "корЫсть", wrong_options: "кОрысть" },
                    { correct_word: "крАны", wrong_options: "кранЫ" },
                    { correct_word: "кремЕнь", wrong_options: "крЕмень" },
                    { correct_word: "кремнЯ", wrong_options: "крЕмня" },
                    { correct_word: "лЕкторов", wrong_options: "лекторОв" },
                    { correct_word: "лОктя", wrong_options: "локтЯ" },
                    { correct_word: "лыжнЯ", wrong_options: "лЫжня" },
                    { correct_word: "мЕстностей", wrong_options: "местностЕй" },
                    { correct_word: "намЕрение", wrong_options: "намерЕние" },
                    { correct_word: "нарОст", wrong_options: "нАрост" },
                    { correct_word: "нЕдруг", wrong_options: "недрУг" },
                    { correct_word: "недУг", wrong_options: "нЕдуг" },
                    { correct_word: "некролОг", wrong_options: "некрОлог" },
                    { correct_word: "нЕнависть", wrong_options: "ненАвисть" },
                    { correct_word: "нефтепровОд", wrong_options: "нефтепрОвод" },
                    { correct_word: "новостЕй", wrong_options: "нОвостей" },
                    { correct_word: "нОгтя", wrong_options: "ногтЯ" },
                    { correct_word: "Отзыв (о книге)", wrong_options: "отзЫв (о книге)" }
                ],
                3: [
                    { correct_word: "отзЫв (посла из страны)", wrong_options: "Отзыв (посла из страны)" },
                    { correct_word: "Отрочество", wrong_options: "отрОчество" },
                    { correct_word: "партЕр", wrong_options: "пАртер" },
                    { correct_word: "портфЕль", wrong_options: "пОртфель" },
                    { correct_word: "пОручни", wrong_options: "порУчни" },
                    { correct_word: "придАное", wrong_options: "прИданое" },
                    { correct_word: "призЫв", wrong_options: "прИзыв" },
                    { correct_word: "свЁкла", wrong_options: "свеклА" },
                    { correct_word: "сирОты", wrong_options: "сИроты" },
                    { correct_word: "созЫв", wrong_options: "сОзыв" },
                    { correct_word: "сосредотОчение", wrong_options: "сосредоточЕние" },
                    { correct_word: "срЕдства", wrong_options: "средствА" },
                    { correct_word: "стАтуя", wrong_options: "статУя" },
                    { correct_word: "столЯр", wrong_options: "стОляр" },
                    { correct_word: "тамОжня", wrong_options: "тАможня" },
                    { correct_word: "тОрты", wrong_options: "тортЫ" },
                    { correct_word: "тУфля", wrong_options: "туфлЯ" },
                    { correct_word: "цемЕнт", wrong_options: "цЕмент" },
                    { correct_word: "цЕнтнер", wrong_options: "центнЕр" },
                    { correct_word: "цепОчка", wrong_options: "цЕпочка" },
                    { correct_word: "шАрфы", wrong_options: "шарфЫ" },
                    { correct_word: "шофЁр", wrong_options: "шОфер" },
                    { correct_word: "экспЕрт", wrong_options: "Эксперт" }
                ]
            },
            "Прилагательные и причастия": {
                1: [
                    { correct_word: "болтлИва", wrong_options: "болтливА" },
                    { correct_word: "вернА", wrong_options: "вЕрна" },
                    { correct_word: "знАчимый", wrong_options: "значИмый" },
                    { correct_word: "красИвее", wrong_options: "красивЕе" },
                    { correct_word: "кУхонный", wrong_options: "кухОнный" },
                    { correct_word: "ловкА", wrong_options: "лОвка" },
                    { correct_word: "мозаИчный", wrong_options: "мозАичный" },
                    { correct_word: "оптОвый", wrong_options: "Оптовый" },
                    { correct_word: "прозорлИва", wrong_options: "прозОрлива" },
                    { correct_word: "прозорлИвый", wrong_options: "прозОрливый" },
                    { correct_word: "прожОрлива", wrong_options: "прожорлИва" },
                    { correct_word: "слИвовый", wrong_options: "сливОвый" },
                    { correct_word: "довезЁнный", wrong_options: "довЕзенный" },
                    { correct_word: "зАгнутый", wrong_options: "загнУтый" },
                    { correct_word: "зАнятый", wrong_options: "занЯтый" },
                    { correct_word: "зАпертый", wrong_options: "запЁртый" },
                    { correct_word: "заселЁнный", wrong_options: "засЕленный" },
                    { correct_word: "занятА", wrong_options: "зАнята" },
                    { correct_word: "заселенА", wrong_options: "засЕлена" },
                    { correct_word: "кормЯщий", wrong_options: "кОрмящий" }
                ],
                2: [
                    { correct_word: "кровоточАщий", wrong_options: "кровотОчащий" },
                    { correct_word: "нажИвший", wrong_options: "нАживший" },
                    { correct_word: "налИвший", wrong_options: "нАливший" },
                    { correct_word: "нанЯвшийся", wrong_options: "нАнявшийся" },
                    { correct_word: "начАвший", wrong_options: "нАчавший" },
                    { correct_word: "нАчатый", wrong_options: "начАтый" },
                    { correct_word: "низведЁнный", wrong_options: "низвЕденный" },
                    { correct_word: "облегчЁнный", wrong_options: "облЕгченный" },
                    { correct_word: "ободрЁнный", wrong_options: "обОдренный" },
                    { correct_word: "обострЁнный", wrong_options: "обОстренный" },
                    { correct_word: "отключЁнный", wrong_options: "отклЮченный" },
                    { correct_word: "повторЁнный", wrong_options: "повтОренный" },
                    { correct_word: "поделЁнный", wrong_options: "подЕленный" },
                    { correct_word: "понЯвший", wrong_options: "пОнявший" },
                    { correct_word: "прИнятый", wrong_options: "принЯтый" },
                    { correct_word: "принятА", wrong_options: "прИнята" },
                    { correct_word: "приручЁнный", wrong_options: "прирУченный" },
                    { correct_word: "прожИвший", wrong_options: "прОживший" },
                    { correct_word: "снятА", wrong_options: "снЯта" },
                    { correct_word: "сОгнутый", wrong_options: "согнУтый" },
                    { correct_word: "углублЁнный", wrong_options: "углУбленный" }
                ]
            },
            "Глаголы": {
                1: [
                    { correct_word: "бралА", wrong_options: "брАла" },
                    { correct_word: "бралАсь", wrong_options: "брАлась" },
                    { correct_word: "взялА", wrong_options: "взЯла" },
                    { correct_word: "взялАсь", wrong_options: "взЯлась" },
                    { correct_word: "влилАсь", wrong_options: "влИлась" },
                    { correct_word: "ворвалАсь", wrong_options: "ворвАлась" },
                    { correct_word: "воспринялА", wrong_options: "воспрИняла" },
                    { correct_word: "воспринЯть", wrong_options: "воспрИнять" },
                    { correct_word: "воссоздалА", wrong_options: "воссоздАла" },
                    { correct_word: "вручИт", wrong_options: "врУчит" },
                    { correct_word: "гналА", wrong_options: "гнАла" },
                    { correct_word: "гналАсь", wrong_options: "гнАлась" },
                    { correct_word: "добралА", wrong_options: "добрАла" },
                    { correct_word: "добралАсь", wrong_options: "добрАлась" },
                    { correct_word: "дождалАсь", wrong_options: "дождАлась" },
                    { correct_word: "он дозвонИтся", wrong_options: "он дозвОнится" },
                    { correct_word: "дозИровать", wrong_options: "дозировАть" },
                    { correct_word: "ждалА", wrong_options: "ждАла" },
                    { correct_word: "жилОсь", wrong_options: "жИлось" },
                    { correct_word: "закУпорить", wrong_options: "закупОрить" }
                ],
                2: [
                    { correct_word: "зАнял", wrong_options: "занЯл" },
                    { correct_word: "занЯть", wrong_options: "зАнять" },
                    { correct_word: "заперлА", wrong_options: "зАперла" },
                    { correct_word: "запломбировАть", wrong_options: "запломбИровать" },
                    { correct_word: "защемИт", wrong_options: "защЕмит" },
                    { correct_word: "звалА", wrong_options: "звАла" },
                    { correct_word: "звонИт", wrong_options: "звОнит" },
                    { correct_word: "кАшлянуть", wrong_options: "кашлянУть" },
                    { correct_word: "клАла", wrong_options: "клалА" },
                    { correct_word: "клЕить", wrong_options: "клеИть" },
                    { correct_word: "крАлась", wrong_options: "кралАсь" },
                    { correct_word: "кровоточИт", wrong_options: "кровотОчит" },
                    { correct_word: "лгалА", wrong_options: "лгАла" },
                    { correct_word: "лилА", wrong_options: "лИла" },
                    { correct_word: "лилАсь", wrong_options: "лИлась" },
                    { correct_word: "навралА", wrong_options: "наврАла" },
                    { correct_word: "наделИт", wrong_options: "надЕлит" },
                    { correct_word: "надорвалАсь", wrong_options: "надорвАлась" },
                    { correct_word: "назвалАсь", wrong_options: "назвАлась" },
                    { correct_word: "накренИтся", wrong_options: "накрЕнится" }
                ],
                3: [
                    { correct_word: "налилА", wrong_options: "налИла" },
                    { correct_word: "нарвалА", wrong_options: "нарвАла" },
                    { correct_word: "начАть", wrong_options: "нАчать" },
                    { correct_word: "нАчал", wrong_options: "начАл" },
                    { correct_word: "обзвонИт", wrong_options: "обзвОнит" },
                    { correct_word: "облегчИть", wrong_options: "облЕгчить" },
                    { correct_word: "облегчИт", wrong_options: "облЕгчит" },
                    { correct_word: "облилАсь", wrong_options: "облИлась" },
                    { correct_word: "обнялАсь", wrong_options: "обнЯлась" },
                    { correct_word: "обогналА", wrong_options: "обогнАла" },
                    { correct_word: "ободралА", wrong_options: "ободрАла" },
                    { correct_word: "ободрИть", wrong_options: "обОдрить" },
                    { correct_word: "ободрИт", wrong_options: "обОдрит" },
                    { correct_word: "он ободрИтся", wrong_options: "он обОдрится" },
                    { correct_word: "обострИть", wrong_options: "обОстрить" },
                    { correct_word: "одолжИть", wrong_options: "одОлжить" },
                    { correct_word: "одолжИт", wrong_options: "одОлжит" },
                    { correct_word: "озлОбить", wrong_options: "озлобИть" },
                    { correct_word: "оклЕить", wrong_options: "оклеИть" },
                    { correct_word: "окружИт", wrong_options: "окрУжит" }
                ],
                4: [
                    { correct_word: "опОшлит", wrong_options: "опошлИт" },
                    { correct_word: "он освЕдомится", wrong_options: "он осведОмится" },
                    { correct_word: "отбылА", wrong_options: "отбЫла" },
                    { correct_word: "отдалА", wrong_options: "отдАла" },
                    { correct_word: "откУпорить", wrong_options: "откупОрить" },
                    { correct_word: "отозвалА", wrong_options: "отозвАла" },
                    { correct_word: "отозвалАсь", wrong_options: "отозвАлась" },
                    { correct_word: "перезвонИт", wrong_options: "перезвОнит" },
                    { correct_word: "перелилА", wrong_options: "перелИла" },
                    { correct_word: "плодоносИть", wrong_options: "плодонОсить" },
                    { correct_word: "пломбировАть", wrong_options: "пломбИровать" },
                    { correct_word: "повторИт", wrong_options: "повтОрит" },
                    { correct_word: "позвалА", wrong_options: "позвАла" },
                    { correct_word: "позвонИт", wrong_options: "позвОнит" },
                    { correct_word: "полилА", wrong_options: "полИла" },
                    { correct_word: "положИть", wrong_options: "полОжить" },
                    { correct_word: "положИл", wrong_options: "полОжил" },
                    { correct_word: "понЯть", wrong_options: "пОнять" },
                    { correct_word: "понялА", wrong_options: "пОняла" },
                    { correct_word: "послАла", wrong_options: "послалА" }
                ],
                5: [
                    { correct_word: "прибЫть", wrong_options: "прИбыть" },
                    { correct_word: "прИбыл", wrong_options: "прибЫл" },
                    { correct_word: "принЯть", wrong_options: "прИнять" },
                    { correct_word: "прИнял", wrong_options: "принЯл" },
                    { correct_word: "рвалА", wrong_options: "рвАла" },
                    { correct_word: "сверлИт", wrong_options: "свЕрлит" },
                    { correct_word: "снялА", wrong_options: "снЯла" },
                    { correct_word: "совралА", wrong_options: "соврАла" },
                    { correct_word: "создалА", wrong_options: "создАла" },
                    { correct_word: "сорвалА", wrong_options: "сорвАла" },
                    { correct_word: "сорИт", wrong_options: "сОрит" },
                    { correct_word: "убралА", wrong_options: "убрАла" },
                    { correct_word: "углубИть", wrong_options: "углУбить" },
                    { correct_word: "укрепИт", wrong_options: "укрЕпит" },
                    { correct_word: "чЕрпать", wrong_options: "черпАть" },
                    { correct_word: "щемИт", wrong_options: "щЕмит" },
                    { correct_word: "щЁлкать", wrong_options: "щелкАть" }
                ]
            },
            "Деепричастия и наречия": {
                1: [
                    { correct_word: "закУпорив", wrong_options: "закупОрив" },
                    { correct_word: "начАв", wrong_options: "нАчав" },
                    { correct_word: "начАвшись", wrong_options: "нАчавшись" },
                    { correct_word: "отдАв", wrong_options: "Отдав" },
                    { correct_word: "поднЯв", wrong_options: "пОдняв" },
                    { correct_word: "понЯв", wrong_options: "пОняв" },
                    { correct_word: "прибЫв", wrong_options: "прИбыв" },
                    { correct_word: "создАв", wrong_options: "сОздав" },
                    { correct_word: "вОвремя", wrong_options: "воврЕмя" },
                    { correct_word: "дОверху", wrong_options: "довЕрху" },
                    { correct_word: "донЕльзя", wrong_options: "дОнельзя" },
                    { correct_word: "дОнизу", wrong_options: "донИзу" },
                    { correct_word: "дОсуха", wrong_options: "досУха" },
                    { correct_word: "зАсветло", wrong_options: "засветлО" },
                    { correct_word: "зАтемно", wrong_options: "затемнО" },
                    { correct_word: "красИвее", wrong_options: "красивЕе" },
                    { correct_word: "надОлго", wrong_options: "нАдолго" },
                    { correct_word: "ненадОлго", wrong_options: "ненАдолго" }
                ]
            }
        };

        // Инициализация
        function init() {
            console.log('=== ИНИЦИАЛИЗАЦИЯ ПРИЛОЖЕНИЯ ===');
            showMainInterface();
            
            // Настройка кнопки "Назад"
            document.getElementById('backButton').addEventListener('click', goBack);
        }

        function showMainInterface() {
            document.getElementById('mainInterface').classList.remove('hidden');
            loadPartsOfSpeech();
        }

        // Загрузка частей речи из данных
        function loadPartsOfSpeech() {
            setLoading(true);
            
            // Получаем доступные части речи из данных
            const parts = Object.keys(wordsData);
            
            showPOSSelection(parts);
            setLoading(false);
            
            // Скрываем кнопку "Назад" на экране выбора части речи
            document.getElementById('backButton').classList.add('hidden');
        }

        function startPOSSelection(pos) {
            currentPOS = pos;
            setLoading(true);
            
            // Получаем доступные двадцатки для этой части речи из данных
            const batchNumbers = Object.keys(wordsData[pos]).map(Number).sort((a, b) => a - b);
            
            console.log('Доступные двадцатки:', batchNumbers);
            showBatchesSelection(pos, batchNumbers);
            setLoading(false);
            
            // Показываем кнопку "Назад"
            document.getElementById('backButton').classList.remove('hidden');
        }

        function showPOSSelection(parts) {
            currentPOS = null;
            currentBatch = [];
            currentIndex = 0;
            mistakes = [];
            lastErrorsForReview = [];
            isReviewMode = false;
            answered = false;

            setSubtitle("Выбери часть речи");
            setSessionInfo("");
            setStatus("");
            clearOptions();
            clearSummary();
            clearFooterButtons();
            hideBatchesSelection();

            const box = document.getElementById("options");
            const wrap = document.createElement("div");
            wrap.className = "pos-choices";

            parts.forEach(pos => {
                const b = document.createElement("button");
                b.className = "pos-btn";
                b.textContent = pos;
                b.onclick = () => startPOSSelection(pos);
                wrap.appendChild(b);
            });

            box.appendChild(wrap);
        }

        function showBatchesSelection(pos, batchNumbers) {
            clearOptions();
            clearSummary();
            clearFooterButtons();
            setStatus("");
            setSessionInfo("");
            
            setSubtitle(`Часть речи: ${pos}`);
            
            const batchesGrid = document.getElementById('batchesGrid');
            batchesGrid.innerHTML = '';
            
            batchNumbers.forEach(batchNum => {
                const card = document.createElement('div');
                card.className = 'batch-card';
                card.innerHTML = `
                    <div>Двадцатка ${batchNum}</div>
                    <small>${wordsData[pos][batchNum].length} слов</small>
                `;
                card.onclick = () => startBatchSession(pos, batchNum);
                batchesGrid.appendChild(card);
            });
            
            document.getElementById('batchesSelection').classList.remove('hidden');
            document.getElementById('options').classList.add('hidden');
        }

        function startBatchSession(pos, batchNumber) {
            console.log('Запускаем двадцатку:', pos, batchNumber);
            
            setLoading(true);
            
            try {
                // Загружаем слова из данных и преобразуем
